<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="index.css" />
  </head>
  <body>
    <div class="mainContainer">
      <div class="requestsContainer">
        <div></div>
      </div>
      <form class="formContainer" name="options" novalidate>
        <div class="formRow">
          <div class="formElement">
            <select class="input" name="method" id="method">
              <option value="GET">GET</option>
              <option value="POST">POST</option>
              <option value="PUT">PUT</option>
            </select>
            <label class="label" for="method"> Метод </label>
          </div>
          <div class="formElement">
            <input class="input" name="url" />
            <label class="label"> URL </label>
          </div>
        </div>
        <div id="parametrs" class="parametrs"></div>
        <button class="textButton" type="button" onclick="handleAddParamsRow()">
          Добавить параметр
        </button>
        <hr class="divider" />
        <div id="headers" class="parametrs"></div>
        <button class="textButton" onclick="handleAddHeaderRow()" type="button">
          Добавить заголовок
        </button>
        <hr class="divider" />
        <div class="buttonsContainer">
          <button class="actionButton">Сохранить запрос</button>
          <button class="actionButton">Отправить запрос</button>
          <button class="actionButton">Очистить форму</button>
        </div>
      </form>
    </div>

    <script async>
      let parametrs = [];
      let headers = [];

      const headersOptions = [
        "Content-type",
        "Origin",
        "Accept",
        "Cache-Control",
        "Access-Control-Allow-Origin",
        "Access-Control-Allow-Headers",
      ];

      function handleAddParamsRow() {
        parametrs.push({ id: parametrs.length + 1 });
        const container = document.getElementById("parametrs");

        if (parametrs.length === 1) {
          const title = document.createElement("h3");
          title.setAttribute("id", "parametrsTitle");
          container.appendChild(title).innerHTML = "Параметры";
        }

        for (let key in parametrs) {
          const val = parametrs[key];
          const datarow = `
            <input class="input" name="paramName" />
            <input class="input" name="paramValue" />
            <button class="textButton" type="button" onclick="handleDeleteParamRow(${val.id})">
              Удалить
            </button>
          `;

          const node = document.createElement("div");
          node.setAttribute("id", `parametr-${val.id}`);
          node.classList.add("paramRow");
          const oldEl = document.getElementById(`parametr-${val.id}`);
          if (oldEl) {
            container.removeChild(oldEl);
          }
          container.appendChild(node).innerHTML = datarow;
        }
      }

      function handleDeleteParamRow(id) {
        const container = document.getElementById("parametrs");
        const element = document.getElementById(`parametr-${id}`);
        container.removeChild(element);
        parametrs = parametrs.filter((item) => item.id !== id);
        if (!parametrs.length) {
          const title = document.getElementById("parametrsTitle");
          container.removeChild(title);
        }
      }

      function handleAddHeaderRow() {
        headers.push({ id: headers.length + 1 });
        const container = document.getElementById("headers");

        if (headers.length === 1) {
          const title = document.createElement("h3");
          title.setAttribute("id", "headersTitle");
          container.appendChild(title).innerHTML = "Заголовки";
        }

        for (let key in headers) {
          const val = headers[key];
          const datarow = `
            <select class="input" name="headerName">
              ${headersOptions.map(
                (item) => `<option value="${item}">${item}</option>`
              )}
            </select>
            <input class="input" name="headerValue" />
            <button class="textButton" type="button" onclick="handleDeleteHeaderRow(${
              val.id
            })">
              Удалить
            </button>
          `;

          const node = document.createElement("div");
          node.setAttribute("id", `header-${val.id}`);
          node.classList.add("paramRow");
          const oldEl = document.getElementById(`header-${val.id}`);
          if (oldEl) {
            container.removeChild(oldEl);
          }
          container.appendChild(node).innerHTML = datarow;
        }
      }

      function handleDeleteHeaderRow(id) {
        const container = document.getElementById("headers");
        const element = document.getElementById(`header-${id}`);
        container.removeChild(element);
        headers = headers.filter((item) => item.id !== id);
        if (!headers.length) {
          const title = document.getElementById("headersTitle");
          container.removeChild(title);
        }
      }
    </script>
  </body>
</html>
